<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>proofable</title>
	<meta name="description" content="Documentation for proofable">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">proofable</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="globals.html">Globals</a>
				</li>
			</ul>
			<h1>proofable</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#proofable-node-sdk" id="proofable-node-sdk" style="color: inherit; text-decoration: none;">
					<h1><a href="https://github.com/SouthbankSoftware/proofable/tree/master/node_sdk">Proofable Node SDK</a></h1>
				</a>
				<p><a href="https://github.com/SouthbankSoftware/proofable/tree/master/node_sdk">Proofable Node SDK</a> provides a set of basic promise-based APIs as well as more advanced callback and stream based APIs. The promise-based APIs are convenient to be consumed in most use cases when dealing with the API Service in <a href="https://www.proofable.io/">Proofable Framework</a>, while the callback and stream based APIs support more advanced features such as canceling and per-call gRPC options.</p>
				<a href="#example" id="example" style="color: inherit; text-decoration: none;">
					<h2>Example</h2>
				</a>
				<p>This is a hello world example written in TypeScript that demonstrates how to:</p>
				<ul>
					<li><p>create a gRPC client</p>
					</li>
					<li><p>prove a bunch of key-values to Ethereum Testnet within a minute</p>
					</li>
					<li><p>create a proof for them</p>
					</li>
					<li><p>verify the proof</p>
					</li>
					<li><p>extract a subproof for just one key-value out of the proof</p>
					</li>
					<li><p>verify the subproof independently</p>
					</li>
				</ul>
				<p>You can find the complete example source code <a href="https://github.com/SouthbankSoftware/proofable/blob/master/node_sdk/src/examples/typescript.ts">here</a>, which can be run as:</p>
				<pre><code class="language-zsh">npm run example</code></pre>
				<p>You can also find the Javascript version <a href="https://github.com/SouthbankSoftware/proofable/blob/master/node_sdk/src/examples/javascript.js">here</a>, which can be run as:</p>
				<pre><code class="language-zsh">npm run example-js</code></pre>
				<a href="#step-1-create-a-grpc-client" id="step-1-create-a-grpc-client" style="color: inherit; text-decoration: none;">
					<h3>Step 1: create a gRPC client</h3>
				</a>
				<p>This step creates a gRPC <a href="https://www.proofable.io/node_sdk/docs/classes/_src_api_client_.apiserviceclient.html"><code>client</code></a>. Note: here we use a magic token to authenticate with <code>proofable-api</code> for testing purpose, which will be changed soon</p>
				<pre><code class="language-typescript"><span class="hljs-keyword">const</span> metadata = <span class="hljs-keyword">new</span> grpc.Metadata();
metadata.add(<span class="hljs-string">&quot;authorization&quot;</span>, <span class="hljs-string">&quot;Bearer magic&quot;</span>);

<span class="hljs-keyword">const</span> client = newApiServiceClient(
  <span class="hljs-string">&quot;https://apigateway.dev.provendb.com&quot;</span>,
  metadata
);</code></pre>
				<a href="#step-2-create-an-empty-trie" id="step-2-create-an-empty-trie" style="color: inherit; text-decoration: none;">
					<h3>Step 2: create an empty trie</h3>
				</a>
				<p>This step creates an empty trie with root <code>0000000000000000000000000000000000000000000000000000000000000000</code>, which is a dictionary that can hold key-values. After using the trie, you should destroy the trie using <a href="https://www.proofable.io/node_sdk/docs/classes/_src_api_client_.apiserviceclient.html#deletetrie"><code>deleteTrie</code></a> or wait for <code>proofable-api</code> to garbage collect it</p>
				<pre><code class="language-typescript"><span class="hljs-keyword">let</span> trie = <span class="hljs-keyword">await</span> client.createTrie();</code></pre>
				<a href="#step-3-set-the-key-values-we-want-to-prove" id="step-3-set-the-key-values-we-want-to-prove" style="color: inherit; text-decoration: none;">
					<h3>Step 3: set the key-values we want to prove</h3>
				</a>
				<p>This step sets a bunch of key-values that we want to prove in the trie we have just created. In the example, they are my home sensor readings. Both key and value can be arbitrary binaries. They key order doesn&#39;t matter. When getting key-values from the trie, e.g. <a href="https://www.proofable.io/node_sdk/docs/classes/_src_api_client_.apiserviceclient.html#gettriekeyvalues"><code>getTrieKeyValues</code></a>, they will always be sorted according to the key&#39;s alphabetical order. When setting key-values, you can also make multiple <a href="https://www.proofable.io/node_sdk/docs/classes/_src_api_client_.apiserviceclient.html#settriekeyvalues"><code>setTrieKeyValues</code></a> calls as a way to build up a large trie incrementally</p>
				<pre><code class="language-typescript">trie = <span class="hljs-keyword">await</span> client.setTrieKeyValues(trie.getId(), trie.getRoot(), [
  KeyValue.from(<span class="hljs-string">&quot;balcony/wind/speed&quot;</span>, <span class="hljs-string">&quot;11km/h&quot;</span>),
  KeyValue.from(<span class="hljs-string">&quot;balcony/wind/direction&quot;</span>, <span class="hljs-string">&quot;N&quot;</span>),
  KeyValue.from(<span class="hljs-string">&quot;living_room/temp&quot;</span>, <span class="hljs-string">&quot;24.8℃&quot;</span>),
  KeyValue.from(<span class="hljs-string">&quot;living_room/Co2&quot;</span>, <span class="hljs-string">&quot;564ppm&quot;</span>),
]);</code></pre>
				<a href="#step-4-create-a-proof-for-the-key-values" id="step-4-create-a-proof-for-the-key-values" style="color: inherit; text-decoration: none;">
					<h3>Step 4: create a proof for the key-values</h3>
				</a>
				<p>This step creates a proof, a.k.a. trie proof, to prove the trie at the given root to Ethereum (<a href="https://www.proofable.io/docs/anchor.html#anchor.Anchor.Type"><code>ETH</code></a>). The trie at the given root contains all the key-values we want to prove. When the trie is proven, so are the key-values contained in</p>
				<pre><code class="language-typescript"><span class="hljs-keyword">let</span> trieProof = <span class="hljs-keyword">await</span> client.createTrieProof(
  trie.getId(),
  trie.getRoot(),
  Anchor.Type.ETH
);</code></pre>
				<a href="#step-5-wait-for-the-proof-to-be-anchored-to-ethereum" id="step-5-wait-for-the-proof-to-be-anchored-to-ethereum" style="color: inherit; text-decoration: none;">
					<h3>Step 5: wait for the proof to be anchored to Ethereum</h3>
				</a>
				<p>This step waits for the proof we have just created until it is anchored to Ethereum, during which we output the anchoring progress</p>
				<pre><code class="language-typescript"><span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> tp <span class="hljs-keyword">of</span> client.subscribeTrieProof(
  trie.getId(),
  trieProof.getId(),
  <span class="hljs-literal">null</span>
)) {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Anchoring proof: %s&quot;</span>, Batch.StatusName[tp.getStatus()]);
  trieProof = tp;
}</code></pre>
				<a href="#step-6-verify-the-proof" id="step-6-verify-the-proof" style="color: inherit; text-decoration: none;">
					<h3>Step 6: verify the proof</h3>
				</a>
				<p>This step verifies the proof we have just created. The verification is supposed to be run at any time after the proof has been created and when we want to make sure our proof is valid as well as retrieving information out from the proof</p>
				<pre><code class="language-typescript"><span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> val <span class="hljs-keyword">of</span> client.verifyTrieProof(
  trie.getId(),
  trieProof.getId(),
  <span class="hljs-literal">true</span>,
  <span class="hljs-string">&quot;proof.dot&quot;</span>
)) {
  <span class="hljs-keyword">if</span> (val <span class="hljs-keyword">instanceof</span> VerifyProofReply) {
    <span class="hljs-keyword">if</span> (!val.getVerified()) {
      <span class="hljs-built_in">console</span>.error(<span class="hljs-string">&quot;falsified proof: %s&quot;</span>, val.getError());
      <span class="hljs-keyword">return</span>;
    }
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// strip the anchor trie part from each key</span>
    <span class="hljs-keyword">const</span> kv = stripCompoundKeyAnchorTriePart(val).to();

    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;\t%s -&gt; %s&quot;</span>, kv.key, kv.val);
  }
}

<span class="hljs-built_in">console</span>.log(
  <span class="hljs-string">&quot;\nthe proof with a root hash of %s is anchored to %s in block %s with transaction %s on %s, which can be viewed at %s&quot;</span>,
  trieProof.getRoot(),
  Anchor.TypeName[trieProof.getAnchorType()],
  trieProof.getBlockNumber(),
  trieProof.getTxnId(),
  <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(trieProof.getBlockTime() * <span class="hljs-number">1000</span>).toUTCString(),
  trieProof.getTxnUri()
);</code></pre>
				<p>This step will output the key-values contained in the proof:</p>
				<pre><code class="language-zsh">balcony/wind/direction -&gt; N
balcony/wind/speed -&gt; 11km/h
living_room/Co2 -&gt; 564ppm
living_room/temp -&gt; 24.8℃</code></pre>
				<p>and a summary:</p>
				<pre><code class="language-zsh">the proof with a root <span class="hljs-built_in">hash</span> of 4711b3b18e379dbdfabd6440428d20cae5784a518605acec48e126e33383f24e is anchored to ETH <span class="hljs-keyword">in</span> block 6231667 with transaction 8e26def59e1a7289e6c322bc49ee4f23f015c17cebafa53c19b6e34561270232 at Tue, 31 Mar 2020 15:33:10 AEDT, <span class="hljs-built_in">which</span> can be viewed at https://rinkeby.etherscan.io/tx/0x8e26def59e1a7289e6c322bc49ee4f23f015c17cebafa53c19b6e34561270232</code></pre>
				<p>and a Graphviz Dot Graph (<code>proof.dot</code>):</p>
				<p><img src="https://github.com/SouthbankSoftware/proofable/raw/master/docs/images/example_proof.svg" alt="Proof Dot Graph"></p>
				<a href="#step-7-extract-a-subproof-for-just-one-key-value-out-of-the-proof" id="step-7-extract-a-subproof-for-just-one-key-value-out-of-the-proof" style="color: inherit; text-decoration: none;">
					<h3>Step 7: extract a subproof for just one key-value out of the proof</h3>
				</a>
				<p>This step extracts a subproof, a.k.a. key-values proof, out of the proof we have just created. The subproof proves the key <code>living_room/Co2</code> only and nothing else. A subproof file named <code>living_room_Co2.subproofable</code> will be created in current working directory. You could also create a subproof for multiple key-values</p>
				<pre><code class="language-typescript"><span class="hljs-keyword">await</span> client.createKeyValuesProof(
  trie.getId(),
  trieProof.getId(),
  KeyValuesFilter.from([Key.from(<span class="hljs-string">&quot;living_room/Co2&quot;</span>)]),
  <span class="hljs-string">&quot;living_room_Co2.subproofable&quot;</span>
);</code></pre>
				<a href="#step-8-verify-the-subproof-independently" id="step-8-verify-the-subproof-independently" style="color: inherit; text-decoration: none;">
					<h3>Step 8: verify the subproof independently</h3>
				</a>
				<p>This step independently verifies the subproof we have just created. The only thing needed in order to verify the subproof is the subproof file itself. The verification is supposed to be run at any time after the subproof has been created and when we want to make sure our subproof is valid as well as retrieving information out from the subproof</p>
				<pre><code class="language-typescript"><span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> val <span class="hljs-keyword">of</span> client.verifyKeyValuesProof(
  <span class="hljs-string">&quot;living_room_Co2.subproofable&quot;</span>,
  <span class="hljs-literal">true</span>,
  <span class="hljs-string">&quot;living_room_Co2_subproof.dot&quot;</span>
)) {
  <span class="hljs-keyword">if</span> (val <span class="hljs-keyword">instanceof</span> VerifyProofReply) {
    <span class="hljs-keyword">if</span> (!val.getVerified()) {
      <span class="hljs-built_in">console</span>.error(<span class="hljs-string">&quot;falsified subproof: %s&quot;</span>, val.getError());
      <span class="hljs-keyword">return</span>;
    }
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// strip the anchor trie part from each key</span>
    <span class="hljs-keyword">const</span> kv = stripCompoundKeyAnchorTriePart(val).to();

    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;\t%s -&gt; %s&quot;</span>, kv.key, kv.val);
  }
}

<span class="hljs-keyword">const</span> ethTrie = <span class="hljs-keyword">await</span> getEthTrieFromKeyValuesProof(
  <span class="hljs-string">&quot;living_room_Co2.subproofable&quot;</span>
);

<span class="hljs-built_in">console</span>.log(
  <span class="hljs-string">&quot;\nthe subproof with a root hash of %s is anchored to %s in block %s with transaction %s on %s, which can be viewed at %s&quot;</span>,
  ethTrie.root,
  ethTrie.anchorType,
  ethTrie.blockNumber,
  ethTrie.txnId,
  <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(ethTrie.blockTime * <span class="hljs-number">1000</span>).toUTCString(),
  ethTrie.txnUri
);</code></pre>
				<p>This step will output the key-values contained in the subproof:</p>
				<pre><code class="language-zsh">living_room/Co2 -&gt; 564ppm</code></pre>
				<p>and a summary:</p>
				<pre><code class="language-zsh">the subproof with a root <span class="hljs-built_in">hash</span> of 4711b3b18e379dbdfabd6440428d20cae5784a518605acec48e126e33383f24e is anchored to ETH <span class="hljs-keyword">in</span> block 6231667 with transaction 8e26def59e1a7289e6c322bc49ee4f23f015c17cebafa53c19b6e34561270232 at Tue, 31 Mar 2020 15:33:10 AEDT, <span class="hljs-built_in">which</span> can be viewed at https://rinkeby.etherscan.io/tx/0x8e26def59e1a7289e6c322bc49ee4f23f015c17cebafa53c19b6e34561270232</code></pre>
				<p>and a Graphviz Dot Graph (<code>living_room_Co2_subproof.dot</code>):</p>
				<p><img src="https://github.com/SouthbankSoftware/proofable/raw/master/docs/images/example_subproof.svg" alt="Subproof Dot Graph"></p>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="globals  ">
						<a href="globals.html"><em>Globals</em></a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_src_api_api_.html">&quot;src/api/api&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_src_api_client_.html">&quot;src/api/client&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_src_api_index_.html">&quot;src/api/index&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_src_api_util_.html">&quot;src/api/util&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_src_examples_typescript_.html">&quot;src/examples/typescript&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_src_hasher_hasher_.html">&quot;src/hasher/hasher&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_src_hasher_index_.html">&quot;src/hasher/index&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_src_index_.html">&quot;src/index&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_src_proof_eth_trie_.html">&quot;src/proof/eth_<wbr>trie&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_src_proof_index_.html">&quot;src/proof/index&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_src_protos_anchor_anchor_grpc_pb_d_.html">&quot;src/protos/anchor/anchor_<wbr>grpc_<wbr>pb.d&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_src_protos_anchor_anchor_pb_d_.html">&quot;src/protos/anchor/anchor_<wbr>pb.d&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_src_protos_anchor_index_.html">&quot;src/protos/anchor/index&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_src_protos_api_api_grpc_pb_d_.html">&quot;src/protos/api/api_<wbr>grpc_<wbr>pb.d&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_src_protos_api_api_pb_d_.html">&quot;src/protos/api/api_<wbr>pb.d&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_src_protos_api_data_stream_.html">&quot;src/protos/api/data_<wbr>stream&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_src_protos_api_index_.html">&quot;src/protos/api/index&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_src_protos_api_util_.html">&quot;src/protos/api/util&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_src_protos_api_verify_proof_reply_stream_.html">&quot;src/protos/api/verify_<wbr>proof_<wbr>reply_<wbr>stream&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_tests_smoke_test_.html">&quot;tests/smoke.test&quot;</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-variable"><span class="tsd-kind-icon">Variable</span></li>
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
				<li class="tsd-kind-function tsd-has-type-parameter"><span class="tsd-kind-icon">Function with type parameter</span></li>
				<li class="tsd-kind-type-alias"><span class="tsd-kind-icon">Type alias</span></li>
				<li class="tsd-kind-type-alias tsd-has-type-parameter"><span class="tsd-kind-icon">Type alias with type parameter</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-interface"><span class="tsd-kind-icon">Interface</span></li>
				<li class="tsd-kind-interface tsd-has-type-parameter"><span class="tsd-kind-icon">Interface with type parameter</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
<script>if (location.protocol == 'file:') document.write('<script src="assets/js/search.js"><' + '/script>');</script>
</body>
</html>